<div class="header">
    <div class="header-body">
        <div class="row align-items-end">
            <div class="col">
                <h6 class="header-pretitle">
                    Viewing Course
                </h6>
                <!-- Title -->
                <h1 class="header-title">
                    {{ course.data.courseCode }} - {{ course.data.courseName }}
                </h1>

            </div>
            <div *ngIf="auth.isDepartment()" class="col-auto">

                <div class="d-inline" *ngIf="!this.isEditingCourse">
                    <!-- Button -->
                    <a *ngIf="!this.requiresTa" (click)="toggleTaRequirement()" class="btn btn-primary lift mr-3">
                        <i class="fe fe-user-plus"></i> Requires TA
                    </a>

                    <a *ngIf="this.requiresTa" (click)="toggleTaRequirement()" class="btn btn-danger lift mr-3">
                        <i class="fe fe-user-minus"></i> Doesn't Require TA
                    </a>
                </div>

                <!-- Button -->
                <a *ngIf="!this.isEditingCourse" (click)="isEditingCourse = true" class="btn btn-white lift">
                    <i class="fe fe-edit-2"></i> Edit
                </a>
                <a *ngIf="this.isEditingCourse" (click)="isEditingCourse = false" class="btn btn-danger lift">
                    <i class="fe fe-x"></i> Cancel
                </a>

            </div>

            <div *ngIf="auth.isInstructor()" class="col-auto">

                <!-- Button -->
                <h2 class="text-primary" *ngIf="this.requiresTa">
                    <span class="badge badge-soft-primary">Requires TA</span>
                </h2>

            </div>
        </div> <!-- / .row -->
    </div> <!-- / .header-body -->

</div>

<div [class.bg-danger]="!isEditingCourse" class="card shadow-lg mb-5 animate__animated animate__faster animate__fadeInUp" *ngIf="auth.isDepartment() && isEditingCourse">
    <div class="card-body">
        <form (ngSubmit)="saveCourse()" [formGroup]="editCourseForm">
            <h2>Edit Course</h2>

            <div class="alert alert-light">
                You can override the total TA hours required for this course.
            </div>

            <div class="row">
                <div class="form-group col-md-5 col-lg-4">
                    <label for="degree">Course Name</label> <input
                        type="text"
                        [ngClass]="{ 'is-invalid':  !editCourseForm.controls.courseName.valid && editCourseForm.controls.courseName.dirty }"
                        formControlName="courseName"
                        placeholder="eg. Software Engineering"
                        id="degree"
                        class="form-control">
                    <div [hidden]="editCourseForm.controls.courseName.valid" class="invalid-feedback">
                        Please enter a course name.
                    </div>
                </div>
                <div class="form-group col-lg-3 col-md-4">
                    <label for="hours">Total TA Hours</label>
                    <div [ngClass]="{ 'is-invalid':  !editCourseForm.controls.totalTaHours.valid && editCourseForm.controls.totalTaHours.dirty }" class="input-group input-group-merge">

                        <input
                                [ngClass]="{ 'is-invalid':  !editCourseForm.controls.totalTaHours.valid && editCourseForm.controls.totalTaHours.dirty }"
                                formControlName="totalTaHours"
                                type="text"
                                id="hours"
                                class="form-control form-control-appended">
                        <div class="input-group-append">
                            <div class="input-group-text">
                                hours
                            </div>
                        </div>
                    </div>
                    <div [hidden]="editCourseForm.controls.totalTaHours.valid" class="invalid-feedback">
                        Please enter a valid number of hours.
                    </div>
                </div>
                <div class=" col-lg-3 col-md-3">
                    <label>&nbsp;</label>
                    <button type="submit" [disabled]="editCourseForm.invalid" class="btn btn-success btn-block">
                        <i class="fe fe-check"></i> Save
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div [class.animate__fadeOutDown]="isEditingCourse" class="animate__animated animate__faster animate__fadeInUp" *ngIf="!isEditingCourse">
    <div class="row">
        <div class="col-12 col-lg-6 col-xl">

            <!-- Value  -->
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">

                            <!-- Title -->
                            <h6 class="text-uppercase text-muted mb-2">
                                Total Sections
                            </h6>

                            <!-- Heading -->
                            <span class="h2 mb-0">
                                {{ course.data.totalSections }}
                            </span>
                        </div>
                    </div> <!-- / .row -->
                </div>
            </div>

        </div>

        <div class="col-12 col-lg-6 col-xl">

            <!-- Hours -->
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">

                            <!-- Title -->
                            <h6 class="text-uppercase text-muted mb-2">
                                Lecture Hours
                            </h6>

                            <!-- Heading -->
                            <span class="h2 mb-0">
                                {{ course.data.lecHours }}
                            </span>
                        </div>
                    </div> <!-- / .row -->
                </div>
            </div>

        </div>
        <div class="col-12 col-lg-6 col-xl">

            <!-- Hours -->
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">

                            <!-- Title -->
                            <h6 class="text-uppercase text-muted mb-2">
                                Lab/Tut Hours
                            </h6>

                            <!-- Heading -->
                            <span class="h2 mb-0">
                                {{ course.data.labHours || '-' }}
                            </span>
                        </div>
                    </div> <!-- / .row -->
                </div>
            </div>

        </div>

        <div class="col-12 col-lg-6 col-xl">

            <!-- Value  -->
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">

                            <!-- Title -->
                            <h6 class="text-uppercase text-muted mb-2">
                                Total TA Hours
                            </h6>

                            <!-- Heading -->
                            <span *ngIf="course.data.totalTaHours" class="h2 mb-0">
                                {{ course.data.totalTaHours }} hours </span> <span *ngIf="!course.data.totalTaHours" class="h3 text-uppercase font-weight-light text-muted  mb-0"> Not Yet Calculated </span>
                        </div>
                    </div> <!-- / .row -->
                </div>
            </div>

        </div>

    </div>

    <div class="card shadow-lg mb-5" *ngIf="auth.isInstructor() && requiresTa">
        <div class="card-body">

            <app-begin-question-process [courseCode]="courseId"></app-begin-question-process>

            <div *ngIf="auth.isInstructor() && requiresTa && currentInstructorQuestionRecord">
                <button *ngIf="!showResponses" (click)="showResponses = true" class="btn btn-white"><i class="fe fe-file-text"></i> View Responses</button>
                <button *ngIf="showResponses" (click)="showResponses = false" class="btn btn-light"><i class="fe fe-x"></i> Hide Responses</button>

                <app-rank-applicants *ngIf="showResponses" [originalQuestions]="currentInstructorQuestionRecord" [courseCode]="course.data.courseCode"></app-rank-applicants>
            </div>
        </div>
    </div>

    <div class="row align-items-end mb-3">
        <div class="col">
            <h2 class="header-title">
                Course Instructors
            </h2>
        </div>
        <div *ngIf="auth.isDepartment()" class="col-auto">
            <button (click)="linkInstructorsExpanded = !linkInstructorsExpanded" class="btn btn-light lift">
                <i class="fe fe-edit-3"></i> Modify Instructors
            </button>
        </div>
    </div>

    <app-all-instructors (linkUpdatedEvent)="fetchCourse()" *ngIf="course.data.instructors.length > 0" [selectedCourse]="course.data" [filteredInstructors]="course.data.instructors"></app-all-instructors>

    <div *ngIf="course.data.instructors.length === 0 || linkInstructorsExpanded" class="alert alert-light font-weight-bold  animate__animated animate__faster animate__fadeInUp">
        <p *ngIf="course.data.instructors.length === 0" class="mb-0">There are no instructors associated with this course.
            <button *ngIf="auth.isDepartment()" class="btn btn-link font-weight-bold" (click)="linkInstructorsExpanded = !linkInstructorsExpanded">Add Instructor(s)</button>
        </p>
        <!--    <app-all-instructors (linkUpdatedEvent)="fetchCourse()" [selectedCourse]="course.data"></app-all-instructors>-->
        <h3 *ngIf="course.data.instructors.length > 0">Modify instructors for this course</h3>
        <app-all-instructors [isBeingEdited]="true" *ngIf="linkInstructorsExpanded" (linkUpdatedEvent)="fetchCourse()" [selectedCourse]="course.data"></app-all-instructors>
    </div>

    <div>
        <div class="row align-items-end mt-5">
            <div class="col">
                <h2 class="header-title">
                    Course TAs
                </h2>
            </div>
            <div *ngIf="auth.isDepartment() && courseTas?.length > 0" class="col-auto">

                <a *ngIf="!this.isEditingApplicants" (click)="isEditingApplicants = true" class="btn btn-white lift">
                    <i class="fe fe-edit-2"></i> Edit TAs
                </a>
                <a *ngIf="this.isEditingApplicants" (click)="isEditingApplicants = false" class="btn btn-danger lift">
                    <i class="fe fe-x"></i> Cancel
                </a>

            </div>
        </div>

        <div *ngIf="courseTas?.length > 0; else noTas">
            <hr>

            Total hours filled:  <span [class.text-success]="hoursFilled" [class.text-danger]="!hoursFilled"><strong>{{ totalFilled }}</strong> / <strong>{{ course.data.totalTaHours }}</strong></span>
            <div *ngIf="!hoursFilled" class="alert alert-light mt-3">
                <strong class="text-danger">Warning!</strong> There are not available applicants who qualify for this course.

                <span *ngIf="auth.isDepartment()">Please
                    <a class="font-weight-bold" (click)="isEditingApplicants = true" href="javascript:;">add a new TA</a>
                   or
                    <a class="font-weight-bold" href="javascript:;" (click)="isEditingCourse = true">change the hours</a>
                   to fulfill the remaining {{ this.course.data.availableTaHours}} hours.
                </span>
            </div>
            <hr>
        </div>

        <div *ngIf="isEditingApplicants" class="my-3">
            <app-link-applicant-to-course (courseAddedEvent)="fetchCourse()" [courseCode]="course.data.courseCode"></app-link-applicant-to-course>
        </div>
        <div *ngIf="courseTas?.length > 0">

            <div *ngFor="let ta of courseTas">
                <app-ta-response-card (approveApplicantEvent)="onApproveApplicantEventReceived($event)" (rejectApplicantEvent)="onRejectApplicantEventReceived($event)" (unlinkedCourseEvent)="unlinkTa($event)" [isApplicantEditingMode]="isEditingApplicants" [noBottomPadding]="true" [compactMode]="true" [response]="ta"></app-ta-response-card>
            </div>
        </div>

        <ng-template #noTas>
            <p class="text-muted">
                There are currently no TAs in this course.
            <span *ngIf="!requiresTa" class="text-muted">
                That could be because this course currently does not require TAs.
            </span>
            </p>
        </ng-template>

    </div>
</div>

