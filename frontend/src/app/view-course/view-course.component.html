<div class="header">
    <div class="header-body">
        <div class="row align-items-end">
            <div class="col">
                <h6 class="header-pretitle">
                    Viewing Course
                </h6>
                <!-- Title -->
                <h1 class="header-title">
                    {{ course.data.courseCode }} - {{ course.data.courseName }}
                </h1>

            </div>
            <div *ngIf="auth.isDepartment()" class="col-auto">

                <div class="d-inline" *ngIf="!this.isEditingCourse">
                    <!-- Button -->
                    <a *ngIf="!this.requiresTa" (click)="toggleTaRequirement()" class="btn btn-primary lift mr-3">
                        <i class="fe fe-user-plus"></i> Requires TA
                    </a>

                    <a *ngIf="this.requiresTa" (click)="toggleTaRequirement()" class="btn btn-danger lift mr-3">
                        <i class="fe fe-user-minus"></i> Doesn't Require TA
                    </a>
                </div>

                <!-- Button -->
                <a *ngIf="!this.isEditingCourse" (click)="isEditingCourse = true" class="btn btn-white lift">
                    <i class="fe fe-edit-2"></i> Edit
                </a>
                <a *ngIf="this.isEditingCourse" (click)="isEditingCourse = false" class="btn btn-danger lift">
                    <i class="fe fe-x"></i> Cancel
                </a>

            </div>

            <div *ngIf="auth.isInstructor()" class="col-auto">

                <!-- Button -->
                <h2 class="text-primary" *ngIf="this.requiresTa">
                    <span class="badge badge-soft-primary">Requires TA</span>
                </h2>

            </div>
        </div> <!-- / .row -->
    </div> <!-- / .header-body -->

</div>

<div [class.bg-danger]="!isEditingCourse" class="card shadow-lg mb-5 animate__animated animate__faster animate__fadeInUp" *ngIf="auth.isDepartment() && isEditingCourse">
    <div class="card-body">
        <form (ngSubmit)="saveCourse()" [formGroup]="editCourseForm" >
            <h2>Edit Course</h2>

            <div class="alert alert-light">
                You can override the total TA hours required for this course.
            </div>

            <div class="row">
                <div class="form-group col-md-5 col-lg-4">
                    <label for="degree">Course Name</label> <input
                        type="text"
                        [ngClass]="{ 'is-invalid':  !editCourseForm.controls.courseName.valid && editCourseForm.controls.courseName.dirty }"
                        formControlName="courseName"
                        placeholder="eg. Software Engineering"
                        id="degree"
                        class="form-control">
                    <div [hidden]="editCourseForm.controls.courseName.valid" class="invalid-feedback">
                        Please enter a course name.
                    </div>
                </div>
                <div class="form-group col-lg-3 col-md-4">
                    <label for="hours">Total TA Hours</label>
                    <div [ngClass]="{ 'is-invalid':  !editCourseForm.controls.totalTaHours.valid && editCourseForm.controls.totalTaHours.dirty }" class="input-group input-group-merge">

                        <input
                                [ngClass]="{ 'is-invalid':  !editCourseForm.controls.totalTaHours.valid && editCourseForm.controls.totalTaHours.dirty }"
                                formControlName="totalTaHours"
                                type="text"
                                id="hours"
                                class="form-control form-control-appended">
                        <div class="input-group-append">
                            <div class="input-group-text">
                                hours
                            </div>
                        </div>
                    </div>
                    <div [hidden]="editCourseForm.controls.totalTaHours.valid" class="invalid-feedback">
                        Please enter a valid number of hours.
                    </div>
                </div>
                <div class=" col-lg-3 col-md-3">
                    <label>&nbsp;</label>
                    <button type="submit" [disabled]="editCourseForm.invalid" class="btn btn-success btn-block">
                        <i class="fe fe-check"></i> Save
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div [class.animate__fadeOutDown]="isEditingCourse" class="animate__animated animate__faster animate__fadeInUp" *ngIf="!isEditingCourse">
    <div class="row">
        <div class="col-12 col-lg-6 col-xl">

            <!-- Value  -->
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">

                            <!-- Title -->
                            <h6 class="text-uppercase text-muted mb-2">
                                Total Sections
                            </h6>

                            <!-- Heading -->
                            <span class="h2 mb-0">
                                {{ course.data.totalSections }}
                            </span>
                        </div>
                    </div> <!-- / .row -->
                </div>
            </div>

        </div>

        <div class="col-12 col-lg-6 col-xl">

            <!-- Hours -->
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">

                            <!-- Title -->
                            <h6 class="text-uppercase text-muted mb-2">
                                Lecture Hours
                            </h6>

                            <!-- Heading -->
                            <span class="h2 mb-0">
                                {{ course.data.lecHours }}
                            </span>
                        </div>
                    </div> <!-- / .row -->
                </div>
            </div>

        </div>
        <div class="col-12 col-lg-6 col-xl">

            <!-- Hours -->
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">

                            <!-- Title -->
                            <h6 class="text-uppercase text-muted mb-2">
                                Lab/Tut Hours
                            </h6>

                            <!-- Heading -->
                            <span class="h2 mb-0">
                                {{ course.data.labHours || '-' }}
                            </span>
                        </div>
                    </div> <!-- / .row -->
                </div>
            </div>

        </div>

        <div class="col-12 col-lg-6 col-xl">

            <!-- Value  -->
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">

                            <!-- Title -->
                            <h6 class="text-uppercase text-muted mb-2">
                                Total TA Hours
                            </h6>

                            <!-- Heading -->
                            <span *ngIf="course.data.totalTaHours" class="h2 mb-0">
                                {{ course.data.totalTaHours }} hours
                            </span>
                            <span *ngIf="!course.data.totalTaHours" class="h3 text-uppercase font-weight-light text-muted  mb-0">
                                Not Yet Calculated
                            </span>
                        </div>
                    </div> <!-- / .row -->
                </div>
            </div>

        </div>


    </div>

    <div class="card shadow-lg mb-5" *ngIf="auth.isInstructor() && requiresTa">
        <div class="card-body">

            <app-begin-question-process [courseCode]="courseId"></app-begin-question-process>

            <div *ngIf="auth.isInstructor() && requiresTa && currentInstructorQuestionRecord">
                <button *ngIf="!showResponses" (click)="showResponses = true" class="btn btn-white"><i class="fe fe-file-text"></i> View Responses</button>
                <button *ngIf="showResponses" (click)="showResponses = false" class="btn btn-light"><i class="fe fe-x"></i> Hide Responses</button>

                <app-rank-applicants *ngIf="showResponses" [originalQuestions]="currentInstructorQuestionRecord" [courseCode]="course.data.courseCode"></app-rank-applicants>
            </div>
        </div>
    </div>

    <div class="row align-items-end mb-3">
        <div class="col">
            <h2 class="header-title">
                Course Instructors
            </h2>
        </div>
        <div *ngIf="auth.isDepartment()" class="col-auto">
            <button (click)="linkInstructorsExpanded = !linkInstructorsExpanded" class="btn btn-light lift">
                <i class="fe fe-edit-3"></i> Modify Instructors
            </button>
        </div>
    </div>

    <app-all-instructors (linkUpdatedEvent)="fetchCourse()" *ngIf="course.data.instructors.length > 0" [selectedCourse]="course.data" [filteredInstructors]="course.data.instructors"></app-all-instructors>

    <div *ngIf="course.data.instructors.length === 0 || linkInstructorsExpanded" class="alert alert-light font-weight-bold  animate__animated animate__faster animate__fadeInUp">
        <p *ngIf="course.data.instructors.length === 0" class="mb-0">There are no instructors associated with this course.
            <button *ngIf="auth.isDepartment()" class="btn btn-link font-weight-bold" (click)="linkInstructorsExpanded = !linkInstructorsExpanded">Add Instructor(s)</button>
        </p>
        <!--    <app-all-instructors (linkUpdatedEvent)="fetchCourse()" [selectedCourse]="course.data"></app-all-instructors>-->
        <h3 *ngIf="course.data.instructors.length > 0">Modify instructors for this course</h3>
        <app-all-instructors [isBeingEdited]="true" *ngIf="linkInstructorsExpanded" (linkUpdatedEvent)="fetchCourse()" [selectedCourse]="course.data"></app-all-instructors>
    </div>

    <div>
        <div class="row align-items-end mb-3 mt-5">
            <div class="col">
                <h2 class="header-title">
                    Course TAs
                </h2>
            </div>
            <div *ngIf="auth.isDepartment() && courseTas?.length > 0" class="col-auto">
                <button class="btn btn-light lift">
                    <i class="fe fe-edit-3"></i> Edit TAs
                </button>
            </div>
        </div>

        <div *ngIf="courseTas?.length > 0; else noTas">

            <div *ngFor="let ta of courseTas">
                <app-ta-response-card [noBottomPadding]="true" [compactMode]="true" [response]="ta"></app-ta-response-card>
            </div>
        </div>

        <ng-template #noTas>
            <p class="text-muted">
                There are currently no TAs in this course.
            </p>
            <p *ngIf="!requiresTa" class="text-muted">
                That could be because this course currently does not require TAs.
            </p>
        </ng-template>

        <app-view-all-tas></app-view-all-tas>
    </div>
</div>
<!--<h2>Course Instructors</h2>-->

<!--<div class="card card-table">-->
<!--    <table class="table table-sm table-nowrap">-->
<!--        <thead>-->
<!--        <tr>-->
<!--            <th scope="col">Class #</th>-->
<!--            <th scope="col">Component</th>-->
<!--            <th scope="col">Section #</th>-->
<!--            <th scope="col">Start</th>-->
<!--            <th scope="col">Capacity</th>-->
<!--            <th scope="col">Class Status</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--        <tr *ngFor="let enrolment of course.enrolments">-->
<!--            <th scope="row">{{ enrolment.classNumber }}</th>-->
<!--            <td><span class="badge badge-soft-primary">{{ enrolment.component }}</span></td>-->
<!--            <td>{{ enrolment.section }}</td>-->
<!--            <td>{{ enrolment.startDate | dateAgo }}</td>-->
<!--            <td>{{ enrolment.capEnrolment || '-' }}</td>-->
<!--            <td>{{ enrolment.percentFull.toFixed(2) }}% full</td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--    </table>-->

<!--</div>-->
